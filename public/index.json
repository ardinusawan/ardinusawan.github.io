[{"content":"Introduction If you hit https://tanggalnya.com, your request will be routed to one of this domain\nhttps://www.tanggalnya.com https://www1.tanggalnya.com https://www2.tanggalnya.com https://www3.tanggalnya.com https://www4.tanggalnya.com Except www, others is routed to my raspy / orange pi in my home.\nBut, how come? How did I expose my raspy \u0026amp; orange pi to outside world?\nArchitecture Let\u0026rsquo;s dig deeper in the architecture first\nI do split ingress to 5 of machine\nVM: www Orange Pi 5: www1 \u0026amp; www2 Raspberry Pi 4: www3 \u0026amp; www4 Here the diagrams: Details In üöÅ view, here the components:\nDNS Load Balancer Services Database Storage DNS Cloudflare is very powerfull DNS provider, here my A and CNAME record\nAs you can see, for A record it just goes to IPv4 address (Vultr Classic VM). For CNAME, it goes to cloudflared tunnel Will keep my Vultr instance for a while until it stable (no complain from customer üòÇ)\nLoad Balancer Cloudflare worker is serverless function (just like AWS Lambda). By using wrangler I build simple load balancer with health check enabled. Do check the code for details ü§ì\nLogs: Services Before hitting my service, ingress is being handled by cloudflared first. Here the folder architecture and config Cloudflared then route the request to nginx\nMy service is consist of monorepo of Nginx + PHP üêò + JS (FE) + hasura.io as GrapqhQL API Server. Nothing much I can say\nFor accessing my server, I use tailscale. Tailscale builds on top of WireGuard by adding automatic mesh configuration, single sign-on (SSO), NAT traversal, TCP transport, and centralized Access Control Lists (ACLs). The best of it? It free up to Up to 100 devices!\nAfter connect to tailscale, then ssh to the internal ip Database Postgres. For now it just single node üòé, obviously SPOF (single point of failure) is here üò¢\nIn the future will build my own cluster DB using patroni hosted obviously in raspy/orange pi.\nStorage For storing asset we choose storj.io, but plan to migrate to Cloudflare R2 in the future (free egress ftw).\nFor image cache \u0026amp; resize service, we do use wsrv\nCaveat Cloudflare Worker is good enough if your traffic is low, but if you need more then better to use (Argo Smart Routing)[https://developers.cloudflare.com/argo-smart-routing/] for load balancer in DNS level (A record) No auto recovery üò¢. But since wrangler is already have health check, if 1 node goes down no traffic will be given Closing Have any question? Wanna discuss? Hit me up on ardi.nusawan13[at]gmail.com!\n","permalink":"http://localhost:1313/posts/website-in-pi/","summary":"Introduction If you hit https://tanggalnya.com, your request will be routed to one of this domain\nhttps://www.tanggalnya.com https://www1.tanggalnya.com https://www2.tanggalnya.com https://www3.tanggalnya.com https://www4.tanggalnya.com Except www, others is routed to my raspy / orange pi in my home.\nBut, how come? How did I expose my raspy \u0026amp; orange pi to outside world?\nArchitecture Let\u0026rsquo;s dig deeper in the architecture first\nI do split ingress to 5 of machine\nVM: www Orange Pi 5: www1 \u0026amp; www2 Raspberry Pi 4: www3 \u0026amp; www4 Here the diagrams: Details In üöÅ view, here the components:","title":"Host your website in raspberry/orange pi"}]